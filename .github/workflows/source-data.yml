name: Source data
on:
  workflow_dispatch:
  schedule:
    - cron: '* 3 * * *'
jobs:
  get_hash:
    runs-on: ubuntu-latest
    outputs:
      256sum: ${{ steps.hashsum.outputs.hash }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Compute hash
        working-directory: 'data'
        id: hashsum
        run: echo "::set-output name=hash::$(sha256sum DE.tab)"
      - name: Print hash
        run: echo "${{ steps.hashsum.outputs.hash }}"
  get_data:
    runs-on: ubuntu-latest
    needs: get_hash
    steps:
      - name: Download data file
        uses: carlosperate/download-file-action@v1.0.3
        id: download
        with:
          file-url: 'http://www.fa-technik.adfc.de/code/opengeodb/DE.tab'
          location: 'data/tmp'
      - name: Print file path
        run: echo "Find the data at ${{ steps.download.outputs.file-path }}"
      - name: Print hash
        run: sha256sum "${{ steps.download.outputs.file-path }}"
      - name: Compare hashes
        working-directory: 'data/tmp'
        run: |
          if ! sha256sum --check --status "${{ needs.get_hash.outputs.256sum }}"; then
            echo "Move updated file to repo version."
          else
            echo "Should be the same file!"
          fi


